---
import { getCollection } from "astro:content";
import Base from "../../layouts/Base.astro";
import BlogPreview from "../../components/BlogPreview.astro";

const pageTitle = "Poems";
const allPosts = await getCollection("poems");

const sortedPosts = allPosts.sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Group by year
const postsByYear = sortedPosts.reduce((acc, post) => {
  const year = new Date(post.data.date).getFullYear();
  acc[year] = acc[year] || [];
  acc[year].push(post);
  return acc;
}, {});
---

<Base title={pageTitle}>
  <div class="max-w-5xl mx-auto">
    <!-- Page Header -->
    <header class="mb-brutalist-2xl border-l-brutalist-thick border-brutalist-orange pl-brutalist-lg">
      <h1 class="text-brutalist-4xl md:text-brutalist-5xl font-brutalist-black uppercase leading-none">
        Poems
      </h1>
      <p class="font-mono text-brutalist-sm md:text-brutalist-base text-brutalist-border uppercase tracking-wider mt-brutalist-xs">
        {sortedPosts.length} Poems
      </p>
    </header>

    <!-- Poems by Year -->
    <div class="space-y-brutalist-2xl">
      {
        Object.entries(postsByYear)
            .sort((a, b) => b[0] - a[0])
            .map(([year, posts]) => (
            <section>
              <div class="mb-brutalist-lg">
                <h2 class="text-brutalist-2xl md:text-brutalist-3xl font-brutalist-black border-b-brutalist border-brutalist-text pb-brutalist-xs inline-block">
                  {year}
                </h2>
              </div>
              <div>
                {
                  posts.map(post => (
                      <BlogPreview
                          title={post.data.title}
                          date={post.data.date}
                          body={post.body}
                          slug={post.slug}
                          type="poems"
                          tags={post.data.tags}
                      />
                  ))
                }
              </div>
            </section>
        ))
      }
    </div>
  </div>
</Base>
